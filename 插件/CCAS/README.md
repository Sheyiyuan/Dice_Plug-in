# _Combat&Chases Assist System_ Help Document

作者：

社亦园（2125107118@qq.com）
冰红茶（2865813065@qq.com）

>本文档日志部分于2024年5月12日开始编写，此时Combat&Chases Assist System的版本为0.2.3，故版本记录从0.2.3开始，要了解之前的版本请自行翻阅代码中的注释。

## 前言

这个插件的想法由冰红茶先行提出，他认为我们可以编写一个插件来进行coc战斗与追逐进行时的辅助，让指令更加简单，并加入自动排序的功能。

说实话，最开始我并不理解他写这个插件的意义，因为战斗排序和结算必须依靠大量的数据比较，相比于在战斗开始前录入一堆数据，我更倾向于让守秘人自行处理而非让骰子来处理。我能够想到这样做的唯一好处就是在整理log的时候工作量会大大减小。

但在我参考规则书列出了我们插件的目标功能后，我突然眼前一亮，立刻意识到了这个插件的意义所在：

```
目标功能
1. 通用基本功能
  1.1 判定建立战斗与追逐
  1.2 NPC 数据录入
2. 战斗辅助系统
  2.1 自动敏捷排序
    2.1.1 直接排序
    2.1.2 含有突袭的排序
    2.1.3 含有先攻检定的排序
  2.2 自动计算伤害
  2.3 自动计算战技
3. 追逐辅助系统
  3.1 辅助建立追逐
    3.1.1 自动判定追逐
    3.1.2 自动排序与行动点计算
  3.2 追逐实况报表
    3.2.1 自动更新打点计时器
    3.2.2 实时行动点显示
    3.2.3 险境与障碍标注
```

这个插件的核心在于第3部分，也就是关于追逐的辅助，在我们之前的跑团之中，我们就已经深刻认识到了这个不受人待见的冷门官规最大的问题：麻烦。

从位置的变更记录到行动点的计算，每个环节都很难让人不怀疑C社里是不是都是人形计算器。在我们几次尝试后，我们对追逐规则做出了一个很中肯的评价：从结果上讲，这个规则很成功，很好玩；但是从过程体验来讲，就\*cw粗口\*。我们一场追逐5轮花了一个多小时，其中大部分时间都浪费在了画图标位置和计算行动点这两件事上。

在这之后，我又想出了一个办法，用一个二维向量$(x,m)$来表示追逐中各个单位的状态，经过我们的测试，这个办法可以有效解决效率问题，让追逐轮的速度与战斗轮接近。但是这个方法的缺点也很明显，向量在表现位移时非常不直观，这对于当时还是高三牲的我们来说都足够抽象，更不用说推广开了。于是我也很快忘记了这回事，直到这份目标功能的列出。

归根结底，追逐规则最大的问题在于付出与收益并不匹配。即使它不完善，并不代表它一无是处，如果能够借助骰子将这个向量组转化为打点计时器图像，那么追逐的时间和精力成本就变得几乎和战斗一样了。这个插件便是我们所设想出的解决方案。

但愿我们的这一份项目能够发挥作用。

任何意见、建议或者催更请联系作者。~~幸运观众有机会获得冰红茶老师的女装写真集。~~

**warning：**
由于作者对插件开发没有任何经验，可能会让整个插件中充斥各种无效语句，缺陷之处还请各位批评指正。

## 目录

[TOC]
## 帮助文档

这部分将会说明如何使用本插件。

### 指令

这一部分记录了所有指令的格式与用法。

**注意：**
指令条目中的“。. ！？”等提示符均略去
#### 一、数据录入部分
在开始使用本插件的战斗与追逐功能之前，要先录入参与单位的数据，这里为了方便，我们将pl的角色称为pc，将kp操作的单位（包括人与其他生单位）称为npc。所有对npc生效的指令对pc同样生效。

数据录入技能默认值：
- '闪避': 25,
- '斗殴': 25,
- '手枪': 20,
- '弓': 15,
- '机枪': 10,
- '冲锋枪': 15,
- '步枪': 25,
- '火焰喷射器': 10,
- '重武器': 10,
- '斧': 15,
- '剑术': 20,
- '链锯': 10,
- '连枷': 10,
- '绞索': 15,
- '鞭': 5,
- '矛': 20,
- '投掷': 20

##### pc录入

- join

由pl使用该指令将自己已st录入的属性导入，可能有一部分非常规技能不兼容。

##### pc数据修改

- modify

modify指令用于修改npc属性

输入格式：
~~~
.modify 单位名称 属性名称 属性值
~~~
特别注意：

体格，DB，最大生命值无法修改，修改生命值时属性名称请填写HP（大写）

修改其他基础属性时请填写属性的英文简称（例如力量是str）（小写）

（如果不满可以@开发者催更）

##### npc录入

- setnpc
功能：批量添加NPC（非玩家角色）至战斗或追逐中。

使用格式：
~~~
.setnpc [NPC数量]
/NPC名称1 属性1 属性2 ...
/NPC名称2 ...
~~~
参数说明：

[NPC数量]：1到20的整数，表示要添加的NPC数量。

/NPC名称 属性...：每组NPC信息间以 / 分隔，信息内属性用空格分隔。最后一个NPC信息后可省略结尾的 /。没有录入的属性会使用人类默认值。

示例：
~~~
.setnpc 4
/ 张三 dex 50 斗殴 50 剑术 40
/ 李四 dex 70 斗殴 65 步枪 20
/ 王五 dex 65 斗殴 70 手枪 30
/ 钱六 dex 40 斗殴 40 闪避 60
~~~

##### npc删除
- dletenpc

删除指定数量的单位（1到20之间）:
~~~
.deletenpc 数量 单位名称1 单位名称2 ...单位名称N
~~~
其中“数量”是一个1到20之间的整数，后面可以跟多个单位名称，每个名称之间以空格分隔。例如，删除3个单位：
~~~
.deletenpc 3 单位A 单位B 单位C
~~~
或者，如果只删除一个特定单位，且该单位名称中不含空格，可以直接输入单位名称作为第一个参数：单位名称
例如，仅删除一个名为“单位D”的单位：
~~~
.deletenpc 单位D
~~~
##### 清空数据
- ccasclear
这个指令会清除录入的所有npc与pc的数据。

#### 二、战斗（combat）系指令部分

这一部分是用于战斗排序和报表相关的指令，由combat开头。

##### 参战单位列表
- combat list

列出参战单位

格式:
~~~
 .combat list
~~~
列出所有已加入战斗的单位列表。

##### 排序规则设置
- combat rule

设置战斗规则

格式: 
~~~
.combat < 规则编号 >
~~~
更改当前战斗规则。规则编号必须是1至3之间的整数，每个编号代表一种不同的战斗规则配置:
-  1: 直接依照敏捷排序
-  2: 含有先发制人（突袭）的战斗排序，参考setnpc与setpc指令
-  3: 含有先攻检定的战斗排序

##### 参战单位排序
- combat rank

排序行动顺序

格式: 
~~~
.combat rank
~~~
根据当前存储的参战单位数据，自动排序并显示行动顺序。

对于带突袭的检定（2号规则），指令格式为：
~~~
.combat rank 张三(突袭单位名称) 50(成功率)
~~~

>tip：在rank指令后加上simple可以返回精简结果。

#### 三、攻击伤害部分
目前仅支持非贯穿伤害计算且不支持护甲。
##### 攻击
- atk

用于计算伤害

使用方法：
~~~
.atk 模式 攻击者 技能 伤害 攻击目标1 攻击目标2 攻击目标3 etc.
~~~
模式为`#`时，攻击目标可以闪避或反击，此时填写的攻击目标部分应形如`张三 闪避`或`张三 反击 1d4`,此处使用反击默认对对方斗殴技能进行检定

模式为`%`时，攻击目标无法闪避或反击，此时填写的攻击目标部分应只包含攻击目标的名字

除此之外，当不填写模式时，指令将变为：
~~~
.atk 技能 伤害 攻击目标1 攻击目标2 攻击目标3 etc.
~~~
此时将把指令发出者作为攻击者，除此之外的部分和模式`#`一致

#### 四、战技部分
##### 战技使用
- skill

skill指令可用于代骰战技

使用方法：
~~~
.skill 模式 攻击者 技能 攻击目标
~~~
  模式为`#`时，攻击目标可以闪避或反击，此时填写的攻击目标部分应形如`张三 闪避`或`张三 反击 1d4`,此处使用反击默认对对方斗殴技能进行检定。

  若省略攻击目标的应对方案，视为攻击目标不进行或无法进行闪避或反击，此时攻击目标部分值包含攻击目标的名称。

  除此之外，当不填写模式时，指令将变为.skill 技能 攻击目标
  此时将把指令发出者作为攻击者，除此之外的部分和模式`#`一致
## 更新记录

### 0.2.3
截至当前版本，实现了以下功能：
- NPC录入，删除。
- 不同战斗规则切换。检定会根据房规设定，但目前仅支持海豹内置的0-5号规则。
- 列出参战单位。
- 按既定规则进行战斗轮排序。

### 0.2.4
- 加入了伤害系统（未完善）。

### 0.2.5
- 加入了战技判定。
- 优化删除指令，现在删除指令不再依附于combat指令。
- ~修复了一些bug。~~新增了一些bug，向ubisoft更进一步。~~

### 0.3.0
- 增加了pc修改指令modify